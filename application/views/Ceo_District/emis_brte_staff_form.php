

<html>

<html lang="en">
    <!-- BEGIN HEAD -->

    <head>
    <style>
        .dashboard-stat2 {
    -webkit-border-radius: 2px;
    -moz-border-radius: 2px;
    -ms-border-radius: 2px;
    -o-border-radius: 2px;
    border-radius: 2px;
    background: #fff;
    padding: 15px 15px 14px !important;
}
    .dashboard-stat2 .display {
    margin-bottom: 2px !important;
}


.badge
{
  color:black !important;
}

.clickable{
    cursor: pointer;   
}

.panel-heading span {
    margin-top: -20px;
    font-size: 15px;
}
.tablecolor
{
    background-color: #32c5d2; 
}

.panel-title
{
  color:#000 !important;
}
.bottom
{
  border-bottom: 1px solid gray;
}
.bs-callout-lightsteelblue {
    border-left: 8px solid lightsteelblue;
    border-radius: 3% !important;
}
.bs-callout-darkseagreen {
    border-left: 8px solid darkseagreen;
    border-radius: 3% !important;
}
.bs-callout-mediumaquamarine {
    border-left: 8px solid mediumaquamarine;
    border-radius: 3% !important;
}
.bs-callout-lightblue {
    border-left: 8px solid lightblue;
    border-radius: 3% !important;
}

.x_panel
{
      padding: 0px 8px !important;
}
.x_title {
    border-bottom: 2px solid #E6E9ED;
    margin: 0px -7px 0px;
    margin-bottom: 10px;
}
.khaki
{
  background-color: khaki;
  color: black;
}
.lightgrey
{
  background-color: lightgrey;
  color: black;

}
.lightyellow
{
  background-color: #f3a84ea6;
  color: black;

}
.lightgreen
{
  background-color: #ceeabf;
  color: black;

}
.portlet.light .dataTables_wrapper .dt-buttons {
    
}

.progress-bar {
    float: left;
    width: 0;
    height: 100%;
    font-size: 12px;
    line-height: 15px!important;
    color: #fff;
    text-align: center;
    background-color: #337ab7;
    -webkit-box-shadow: inset 0 -1px 0 rgba(0,0,0,.15);
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.15);
    -webkit-transition: width .6s ease;
    -o-transition: width .6s ease;
    transition: width .6s ease;
}
.progress
{
    height: 14px!important;
    margin-bottom:0px!important;

    text-indent:0px !important;
}
.progress-bar-success
{
    background-color:#5cb85c!important;
}
.center 
{
text-align: center!important;
}

.color-box-green
{
    
    cursor: pointer;
    width: 29px;
    height: 11px;
    border-radius: 3px;


}
body.modal-open {
    overflow-y: hidden !important;
    position: fixed;
}
.select2-container--bootstrap .select2-results__option[aria-selected=true] {
    background-color: #f6f681 !important;
    color: #262626;
}

.select2-container--bootstrap {
    display: block;
    width: auto !important;
}

.sweet-alert {
    background-color: #ffffff;
    width: 478px;
    padding: 17px;
    border-radius: 5px;
    text-align: center;
    position: fixed;
    left: 50%;
    top: 50%;
    margin-left: -256px;
    margin-top: -200px;
    overflow: hidden;
    display: none;
    z-index: 100000 !important;
}
    </style>
    <link href="<?php echo base_url().'asset/pages/css/about.min.css';?>" rel="stylesheet" type="text/css" />
<link href="<?php echo base_url().'asset/global/plugins/simple-line-icons/simple-line-icons.min.css';?>" rel="stylesheet" type="text/css" />
<link href="<?php echo base_url().'asset/global/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.css';?>" rel="stylesheet" type="text/css" />
        <link href="<?php echo base_url().'asset/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css';?>" rel="stylesheet" type="text/css" />
        <link href="<?php echo base_url().'asset/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css';?>" rel="stylesheet" type="text/css" />
        <link href="<?php echo base_url().'asset/global/plugins/bootstrap-editable/bootstrap-editable/css/bootstrap-editable.css';?>" rel="stylesheet" type="text/css" />
        <link href="<?php echo base_url().'asset/global/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.css';?>" rel="stylesheet" type="text/css" />
        <link href="<?php echo base_url().'asset/global/plugins/bootstrap-editable/inputs-ext/address/address.css';?>" rel="stylesheet" type="text/css" />
        <link href="<?php echo base_url().'asset/global/plugins/select2/css/select2.min.css';?>" rel="stylesheet" type="text/css" />
        <link href="<?php echo base_url().'asset/global/plugins/select2/css/select2-bootstrap.min.css';?>" rel="stylesheet" type="text/css" />
        <link href="<?php echo base_url().'asset/global/plugins/datatables/datatables.min.css';?>" rel="stylesheet" type="text/css" />
        <link href="<?php echo base_url().'asset/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css';?>" rel="stylesheet" type="text/css" />
        <?php $this->load->view('head.php'); ?>
        <!-- BEGIN PAGE LEVEL STYLES -->
    
       
        <!-- END PAGE LEVEL STYLES -->

        </head>
    <!-- END HEAD -->

    <body class="page-container-bg-solid page-md">
        <div class="page-wrapper">
            

  <?php $this->load->view($header.'/header.php'); ?>

            <div class="page-wrapper-row full-height">
                <div class="page-wrapper-middle">
                    <!-- BEGIN CONTAINER -->
                    <div class="page-container">
                        <!-- BEGIN CONTENT -->
                        <div class="page-content-wrapper">
                            <!-- BEGIN CONTENT BODY -->
                            <!-- BEGIN PAGE HEAD-->
                            <div class="page-head">

                                
                            </div>
                            <!-- END PAGE HEAD-->
                            <!-- BEGIN PAGE CONTENT BODY -->
                            <div class="page-content">
                                <div></div> 
                                <div class="container">

                                    <!-- BEGIN PAGE CONTENT INNER -->
                                    

                                    <div class="page-content-inner">

                                     <div class="portlet-body">
                                      <div class="portlet light">
                                        <div class="portlet-body">
                                
                                                <div class="row">
                                                    <div class="col-md-12">
                                              <!-- BEGIN EXAMPLE TABLE PORTLET-->
                                                  <div class="portlet box green">
                                                    <div class="portlet-title">
                                                        <div class="caption">
                                                            <i class="fa fa-globe"></i> BRTE School List </div>
                                                            <div class="col-md-offset-3 col-md-2">
                                                              <button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal">Add School Group </button>
                                                              
                                                            </div>
                                                            <div class="col-md-1">
                                                                <button type="button" class="btn btn-info" onclick="get_school_group(0,1);">Assign BRTE To Nodal School </button>
                                                            </div>
                                                        <div class="tools"> 

                                                        </div>
                                                    </div>
                                                    <div class="portlet-body">
                                                        <ul class="nav nav-tabs nav-tabs-success faq-cat-tabs " id="myTab">
                <li class="active"><a href="#faq-cat-1" data-toggle="tab">Brte Nodal School List</a></li>
                <li><a href="#faq-cat-2" data-toggle="tab">BRC Block List</a></li>
            </ul>
            <div class="tab-content faq-cat-content">
                <div class="tab-pane active in fade" id="faq-cat-1">
                        <?php if(!empty($brte_school_map_list)){  
                                                       // echo"<pre>";print_r($allstuds);echo"</pre>";?>
                                                        <table class="table table-bordered table-hover" id="sample_3">
                                                            <thead>
                                                                <tr>
                                                                    <th> S.No </th>         
                                                                    <th class=""> Block Name</th>
                                                                    <th class=""> Nodal School</th>
                                                                    <th class=""> HM Name</th>
                                                                    <th> Brte Name</th>


                                                                    <th class="detail"> Assigned School </th>
                                                                    <!-- <th class="detail">Pass/Fail</th> -->
                                   
                                                                   
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                <?php $i=1; 

                                                                // print_r($students_list);
                                                                foreach($brte_school_map_list as $all){ ?>
                                                                <tr> 
                                                                    <td><?=$i?></td>
                                                                     <td><?=$all->block_name;?></td>
                                                                    <td><a href="javascript:void(0);" onclick="brte_staff_edit(<?=$all->hss_school_id;?>)"><?=$all->hss_school_name;?></a></td>
                                                                    <td><?=($all->teacher_type==26 || $all->teacher_type==27?$all->teacher_name.'-'.$all->mbl_nmbr:'HM Not Assigned In  EMIS');?></td>
                                                                    <td style="text-align: center !important;"><a href="javascript:void(0);" onclick="get_school_group(<?=$all->hss_school_id;?>,1)"><?=$all->brte_name;?></td>
                                                                    <td><?=str_replace(","," ", $all->school_name); ?></td>
                                                                   
                                  
                                                                
                                                                 
                                                                </tr>
                                                                <?php $i++; } ?>
                                                            
                                                      
                                                            </tbody>
                                                        </table>
                                                         <?php } else { ?><center>No Data Available!</center><?php } ?>
                 </div>
                 <div class="tab-pane fade" id="faq-cat-2">
                    <div class="panel-group" id="accordion-cat-2">
                        <div class="panel panel-default panel-faq">
                                <table class="table table-bordered table-hover" id="sample_4">
                                                            <thead>
                                                                <tr>
                                                                    <th> S.No </th>         
                                                                    <th class=""> Block Name</th>
                                                                    <th class=""> Office Name</th>
                                                                    <th> Brte Name</th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <?php if(!empty($brte_brc_map_list)){
                                                                        foreach($brte_brc_map_list as $index=> $all){
                                                                        ?>
                                                                        <tr>
                                                                        <td><?=$index+1;?></td>
                                                                        <td><a href="javascript:void(0);" onclick="get_school_group(<?=$all->brc_block_id;?>,2)"><?=$all->office_area;?></a></td>
                                                                        <td><?=$all->office_name;?></td>
                                                                        <td><?=$all->name;?></td>
                                                                    </tr>

                                                                    <?php }}?>
                                                                </tbody>
                                                            </table>
                        </div>
                    </div>
                </div>
                 
            </div>
                                                    
                                                    </div>
                                                </div>
                                                <!-- END EXAMPLE TABLE PORTLET-->           

                                                    </div>
                                                </div>
                                            </div>
                                             
                                        </div>  
                                        

                                            </div>  

                                           
                        
                    </div>
                    <!-- END CONTAINER -->

                </div>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</div>

<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog modal-lg" style="width:1193px;">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" id="title">Add School Group Details</h4>
        </div>
        <div class="modal-body">
         <form  id="myform" class="myform" method="post" name="myform">
                                        <div class="row">
                                            <div class="col-md-4">
    <label for="title" class="center">Select Block</label>

                                                


    <select multiple id="block_id" style="width:300px" name="block[]" >
     
<?php if(!empty($block_details)){
        foreach($block_details as $blk){
  ?>
  <option value="<?=$blk->id;?>"><?=$blk->block_name;?></option>
<?php } } ?>
    </select>
  
</div>


<div class="col-md-4">
<label for="">School Type</label>
<select id="sch_ctype_id" name="sch_ctype_id" class="form-control" required="" onchange="get_pri_schools('',this.value,0)"> 
<option value="">Select School Type</option>
<option value="1">High School</option>
<option value="2">Higher Secondary School</option>
</select>
</div>
<div class="col-md-4">

<label for="">Nodal School</label>
<select id="hss_id" name="hss_id" class="form-control" required="" onchange="hss_school_details()"> 
<option value="0">Select School</option>

</select>
</div>
</div>
<br/>
<!-- div class="row">
                <div class="col-md-4"> 
<label for="">BRTE Teacher List</label>
<div class="form-group" id="">


    <select multiple id="brte_teacher" style="width:300px" name="brte_teacher[]" class="form-control" required="">
     
<?php if(!empty($brte_list)){
        foreach($brte_list as $brte){
  ?>
  <option value="<?=$brte->u_id;?>"><?=$brte->teacher_name;?></option>
<?php } } ?>
    </select>
  </div>

<span id="teach_subject"></span>

</div>
</div-->
<br/>

    
    <div class="row "><div class="col-md-5"><input type="text" id="search_school" class="form-control" placeholder="search school Details" onkeyup="search_schools();"><br/></div><div class="col-md-6"><div id="msg"><font style="color:red;"></font></div></div></div><div class="row"><div class="col-md-5"><select class="form-control" id ="school_list" name="school_list[]" multiple="multiple" style="height:150px;"></select></div><div class="col-md-2" style="text-align: -webkit-center;margin-top: 45px;"><div class="input-group"><button type="button" value="" class="btn btn-xs btn-primary" id="add" style="padding: 5px 24px;" onclick="addSchool();">Add >></button></div><div class="input-group" style="padding-top:10px;"><button type="button" value="" class="btn btn-xs btn-danger" id="remove" style="padding: 5px 12px;" onclick="removedSchool()"><< Remove</button></div></div><div class="col-md-5"><select class="form-control" name="selected_schools[]" size="9" id="selected_schools" multiple="multiple" style="height:150px;"></select></div></div><br/>

                
               
                
                


                                            </form>
        </div>
          
        <div class="modal-footer">

          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
           <button type="button" value="" class="btn btn-primary" onclick="save()">Save</button>
              <font style="color:red"><span id="err_msg"></span></font>

        </div>
      </div>
      
    </div>
  </div>



  <!-------- Brte Added Data ----------->

  <div class="modal fade" id="brteModal" role="dialog">
    <div class="modal-dialog modal-lg" style="width:1193px;">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
            <div class="row">
                <div class="col-md-4">
                    <h4 class="modal-title" id="btitle">Add BRTE School Details</h4>
                </div>
                <div class="col-md-3">
                    <select id="brte_selection" class="form-control">
              <option value="1">Assign To School</option>
              <option value="2">Assign To BRC </option>

          </select>
                </div>
                <div class="col-md-offset-4 col-md-1">
          <button type="button" class="close" data-dismiss="modal">&times;</button>

                </div>
            </div>
          
          
        </div>
        <div class="modal-body">
             <div class="row">
                <div class="col-md-4"> 
<label for="">BRTE Teacher List</label>
<div class="form-group" id="">


    <select multiple id="brte_teacher" style="width:300px" name="brte_teacher[]" class="form-control" required="">
     
<?php if(!empty($brte_list)){
        foreach($brte_list as $brte){
  ?>
  <option value="<?=$brte->u_id;?>"><?=$brte->teacher_name;?></option>
<?php } } ?>
    </select>
  </div>

<span id="teach_subject"></span>

</div>
<div class="col-md-4 sgroup" id="1"> 
<label for="">BRTE School Group</label>
<div class="form-group" id="">


    <select multiple id="brte_school" style="width:300px" name="brte_school[]" class="form-control" required="">
        </select>
    </div>
</div>
<div class="col-md-4 sgroup" id="2">
    <label for="title" class="center">Select Block</label>

                                                


    <select id="brc_block_id" style="width:300px" name="block" class="form-control">
     <option value="">Select Block</option>
<?php if(!empty($block_details)){
        foreach($block_details as $blk){
  ?>
  <option value="<?=$blk->id;?>"><?=$blk->block_name;?></option>
<?php } } ?>
    </select>
    </div>
</div>
        </div>
         <div class="modal-footer">

          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
           <button type="button" value="" class="btn btn-primary" onclick="save_brte()">Save</button>
              <font style="color:red"><span id="err_msg_brte"></span></font>

        </div>
        </div>
    </div>
   </div>

                  <?php $this->load->view('footer.php'); ?>
           


                   <?php $this->load->view('scripts.php'); ?>
        <script src="<?php echo base_url().'asset/js/district.js';?>" type="text/javascript"></script>


    <script src="<?php echo base_url().'asset/global/plugins/bootstrap-wysihtml5/wysihtml5-0.3.0.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/moment.min.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/jquery.mockjax.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/bootstrap-editable/bootstrap-editable/js/bootstrap-editable.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/bootstrap-editable/inputs-ext/address/address.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/bootstrap-editable/inputs-ext/wysihtml5/wysihtml5.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/bootstrap-typeahead/bootstrap3-typeahead.min.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/select2/js/select2.full.min.js';?>" type="text/javascript"></script>
        <!-- END PAGE LEVEL PLUGINS -->
        <!-- BEGIN PAGE LEVEL SCRIPTS -->
        <script src="<?php echo base_url().'asset/global/scripts/datatable.js';?>" type="text/javascript"></script>
        <script src="<?php echo base_url().'asset/global/plugins/datatables/datatables.min.js" type="text/javascript';?>"></script>
        <script src="<?php echo base_url().'asset/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js';?>" type="text/javascript"></script>
              <script src="<?php echo base_url().'asset/pages/scripts/table-datatables-colreorder.min.js';?>" type="text/javascript"></script>
              <script type="text/javascript">
            $(document).ready(function(){
            $("#myModal").modal('hide');
        });
             

  $(document).on('click', '.panel-heading span.clickable', function(e){
    var $this = $(this);
    if(!$this.hasClass('panel-collapsed')) {
        $this.parents('.panel').find('.panel-body').slideUp();
        $this.addClass('panel-collapsed');
        $this.find('i').removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
    } else {
        $this.parents('.panel').find('.panel-body').slideDown();
        $this.removeClass('panel-collapsed');
        $this.find('i').removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
    }
})
        </script>
        <script type="text/javascript">
            var flash_data = <?php echo json_encode($old_flash_message)?>;
  // console.log(flash_data);
  function show_data(data)
  {

    // console.log(data);
      var flash_details = flash_data.filter(flash=>flash.id == data)[0];
      // console.log(flash_details); 
      $(".modal-title").text(flash_details.title);
      $('.content').text(flash_details.content);
      // $('#create').text(flash_details.user_type +' - '+flash_details.created_date);
      $("#myModal").modal('show');
  }
        </script>
      

<script type="text/javascript">
    $(document).ready(function()
{
    sum_dataTable('#sample_3');
    sum_dataTable('#sample_4');
   
});

function sum_dataTable(dataId){
    var table = $(dataId).DataTable({
      dom: 'Blfrtip',
      order: [[0, "asc"]],
            lengthMenu: [[5, 10, 15, 20, -1], [5, 10, 15, 20, "All"]],
            pageLength: -1,
            info: "Showing _START_ to _END_ of _TOTAL_ entries",
        buttons: [
            'colvis'
        ],
        buttons: [
                { extend: 'print', className: 'btn default' },
                { extend: 'pdf', className: 'btn default' },
                { extend: 'csv', className: 'btn default' },
    //             {
    //     extend: 'colvis',
       
    //     className: 'btn default',
    //     columnText: function ( dt, idx, title ) {

    //         return (idx+1)+': '+title;
    //     }
    // }
            ],

    "footerCallback": function ( row, data, start, end, display ) {
        this.api().columns('.sum').every(function () {
            var column = this;
          var intVal = function ( i ) {
                return typeof i === 'string' ?
                    i.replace(/[\$,]/g, '')*1 :
                    typeof i === 'number' ?
                        i : 0;
            };
            var sum = column
               .data()
               .reduce(function (a, b) { 
                // console.log(a);
                   a = intVal(a, 10);
                   if(isNaN(a)){ a = 0; }
                   
                   b = intVal(b, 10);
                   if(isNaN(b)){ b = 0; }
                   
                   return a + b;
               });
column.selector.opts.page='current';
               var currentPage = column
               .data()
               .reduce(function (a, b) { 
                   a = parseInt(a, 10);
                   if(isNaN(a)){ a = 0; }
                   
                   b = parseInt(b, 10);
                   if(isNaN(b)){ b = 0; }
                   
                   return a + b;
               });
               
            sum = sum.toLocaleString(undefined, {maximumFractionDigits:3});
            $(column.footer()).html(sum);
                        });
            }
        });
    // table.column(0).visible(false);
    }
</script>

<script>
    $(document).ready(function(){
    $('a[data-toggle="tab"]').on('show.bs.tab', function(e) {
        localStorage.setItem('activeTab', $(e.target).attr('href'));
    });
    var activeTab = localStorage.getItem('activeTab');
    if(activeTab){
        console.log(activeTab);
        $('#myTab a[href="' + activeTab + '"]').tab('show');
    }
});
    </script>

    <script type="text/javascript">
      $(document).ready(function(){
    
});


    </script>

  <script type="text/javascript">

    var teacher_details = <?php echo json_encode($brte_list);?>;
    var hss_list = '';
    var school_map_list_details = <?=json_encode($brte_school_map_list)?>;
    var pri_schools = '';
    var hss_sch_id = '';
    var pri_mid_schools = '';
    var pri_selected_schools = '';
    var map_list_detail = '';
    $(".sgroup").hide();
     $("#block_id").select2({closeOnSelect:false});
    $("#brte_teacher").select2({closeOnSelect:false});
    $("#brte_school").select2({closeOnSelect:false});
    
    $(".multi_sch_list").hide();
    $("#myModal").on("hidden.bs.modal", function(){
    window.location.reload();
});
    $("#brteModal").on("hidden.bs.modal", function(){
    window.location.reload();
});



    $('#block_id').on('select2:select', function(e) {
    block_array = new Array();
    if($("#block_checkbox").not(':checked'))
    {
        
        var block_name = $("#block_id").val();
       get_pri_schools(block_name,'',0);
        
        

    }


 });

  $('#block_id').on('select2:unselect', function(e) {
    block_array = new Array();
    if($("#block_checkbox").not(':checked'))
    {
        var block_name = $("#block_id").val();

       console.log(block_name);
       get_pri_schools(block_name,'',0);
    }
    // console.log(block_array);

    });
    // Edit
    function brte_staff_edit(school_id)
    {
        map_list_detail = school_map_list_details.filter(map_list=>map_list.hss_school_id==school_id)[0];
        console.log(map_list_detail)
        // var selected_school = map_list_details.school_name.split("<br/>");
            var school_drop = '';
            var block_id = map_list_detail.block_id.split(",");
            $("#selected_schools").html('');
            
            $("#block_id").val(block_id).trigger('change');
            $("#hss_id").val(map_list_detail.hss_school_id).attr('selected','selected');
            // $("#brte_teacher").val(map_list_detail.brte_id).attr('selected','selected');
            hss_sch_id = school_id;
            $("#title").html(map_list_detail.hss_school_name+'-'+map_list_detail.hss_udise_code)
            $("#msg > font").html('* Remove Schools One By One Only');
            var hss_id = '';
            if(map_list_detail.hss_cate_type=="High School")
            {
                hss_id = 1;
            }else if(map_list_detail.hss_cate_type=='Higher Secondary School')
            {
                hss_id =2;
            }else
            {
                hss_id = 2;
            }
            $("#sch_ctype_id").val(hss_id).attr('selected','selected');
            get_pri_schools(block_id,'',school_id);

            $("#myModal").modal('show');
    }
    // Add
    // $("#brte_teacher").change(function()
    //   {
    //       var teach_id = $(this).val();
    //       $("#teach_subject").html('');
    //       teacher_detail = teacher_details.filter(teach=>teach.u_id==teach_id)[0];

    //       $("#teach_subject").html('<h5> Appointed Subject : '+teacher_detail.subjects+'</h5>');
    //   })

    // Edit Change Hss School




      function get_pri_schools(block_id,sch_ctype_id,hss_sch_id)
      {

            // console.log(block_id);return false;
          if(block_id !='')
          {
            block_id = block_id;
            sch_ctype_id = $("#sch_ctype_id").val();
          }else
          {
            block_id = $("#block_id").val();
            sch_ctype_id = sch_ctype_id;
          }
          console.log(block_id,sch_ctype_id,hss_sch_id);

          if(block_id !='' && sch_ctype_id !='')
          {

            $.ajax(
            {
              method:"POST",
              url:'<?=base_url()."Ceo_District/get_primary_school_list"?>',
              data:{'block_id':block_id,'hss_school_id':hss_sch_id,'sch_ctype_id':sch_ctype_id},
              dataType:'JSON',
              success:function(res)
              {
                  
                  
                  hss_list = res.hss_list;
                  pri_selected_schools = res.pri_selected_list;
                  var school_drop = '';
                  var hss_school_drop = '';
                  


                  // HSS School list
                  hss_school_drop = '<option value="">Select School</option>';
                  sch_ctype_id = (sch_ctype_id==1?'High School':'Higher Secondary School');
                 var  search_hss_list = res.hss_list.filter(hss=>hss.cate_type == sch_ctype_id);
                  $("#hss_id").empty();
                  hss_school_drop = '<option value="">Select School</option>';
                  $.each(search_hss_list,function(i,val)
                  {
                    if(map_list_detail !=''){
                    if(val.brte==0 || val.school_id ==map_list_detail.hss_school_id)
                    {
                      hss_school_drop += '<option value='+val.school_id+'>( '+val.udise_code+') '+val.school_name+'</option>';
                    }
                    }else
                    {
                        hss_school_drop += '<option value='+val.school_id+'>( '+val.udise_code+') '+val.school_name+'</option>';
                    }

                  });
                  $("#hss_id").html(hss_school_drop);
                   if(hss_sch_id !=0)
                  {
                    console.log(hss_sch_id);
                        $("#hss_id").val(hss_sch_id).attr('selected','selected');
                  }


                  if(hss_sch_id!=0)
                  {
                    $("#selected_schools").empty();
                    hss_selected_school_drop = '';
                  $.each(res.pri_selected_list,function(i,val)
                  {
                      hss_selected_school_drop += '<option value='+val.school_id+'>( '+val.udise_code+') '+val.school_name+'</option>';

                  });
                  $("#selected_schools").html(hss_selected_school_drop);
                  hss_school_details();
                  }

              }
            })
          }
      }

      function hss_school_details(){

            $("#school_list").empty();
            var hss_sch_id = $("#hss_id").val();
                if(map_list_detail !='')
                {
                    if(map_list_detail.hss_school_id!=hss_sch_id)
                    {
                        swal({
                            title: "Are you sure?",
                            text: 'Change Nodal School',
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#ff0000",
                            confirmButtonText: "Confirm",
                            cancelButtonText:'Cancel',
                            closeOnConfirm: false,
                            showLoaderOnConfirm: true
                        }, function(isConfirm)
                        {
                          if(isConfirm){
                            
                         $.ajax(
                         {
                            method:'POST',
                            data:{'school_id':map_list_detail.hss_school_id},
                            dataType:'JSON',
                            url:'<?=base_url()."Ceo_District/check_brte_staff_school"?>',
                            success:function(res)
                            {
                                if(res.count >0){
                                swal(
                                {
                                  title: res.count+" Brte Already Assigned To this Nodal School",
                                  type:'error',
                                  confirmButtonText: "Ok",
                                },function(isConfirm)
                                {

                                    window.location.reload();
                                });
                                }else
                                {
                                    swal.close();
                                }
                            }

                         });
                    }else
                    {
                        $("#hss_id").val(map_list_detail.hss_school_id);
                    }
                    });   
                }
            }
                    pri_schools = hss_list.filter(hss=>hss.school_id!=hss_sch_id && (hss.brte==0|| hss.school_id==map_list_detail.hss_school_id));
                    pri_mid_schools = pri_schools;
                    
                    var school_drop = '';
                      $.each(pri_schools,function(i,val)
                      {
                          school_drop += '<option value='+val.school_id+'>'+'( '+val.udise_code+' ) '+val.school_name+'</option>';
                      });
                

                  $("#school_list").append(school_drop);
      
  }


      


  function generate_brte_assign_school()
  {
        var form_array = '';
        console.log(block_array);
            if(block_array !=null)
            {
                $("#multi_sch_list").empty();
                $.each(block_array,function(i,val)
                {
                    
                    form_array += '<div class="row multi_sch_list"><div class="col-md-5"><input type="text" id="search_school'+i+'" class="form-control" placeholder="search school Details" onkeyup="search_schools('+i+');"><br/></div><div class="col-md-6"><div id="msg"><font style="color:red;"></font></div></div></div><div class="row">Brte Name '+val.teacher_name+'<div class="col-md-5"><select class="form-control" id ="school_list'+i+'" name="school_list[]" multiple="multiple" style="height:150px;">';

                    $.each(pri_schools,function(pi,pval){
                        form_array +='<option value='+pval.school_id+'>( '+pval.udise_code+') '+pval.school_name+'</option>';
                    });
                    form_array +='</select></div><div class="col-md-2" style="text-align: -webkit-center;margin-top: 45px;"><div class="input-group"><button type="button" value="" class="btn btn-xs btn-primary" id="add" style="padding: 5px 24px;" onclick="addSchool('+i+');">Add >></button></div><div class="input-group" style="padding-top:10px;"><button type="button" value="" class="btn btn-xs btn-danger" id="remove" style="padding: 5px 12px;" onclick="removedSchool('+i+')"><< Remove</button></div></div><div class="col-md-5"><select class="form-control" name="selected_schools[]" size="9" id="selected_schools'+i+'" multiple="multiple" style="height:150px;"></select></div></div><br/>';
                    
                });

                $("#multi_sch_list").append(form_array);
            }
  }

      function addSchool(){  
    // console.log($("#selected_schools").val());
    
        form_array = '';

            // $.each(block_array,function(bi,bval){
            $('#school_list option:selected').each(function(si,val){
                // console.log(this.value);
           pri_schools =  pri_schools.filter((eval,ei)=>
            {
                   if(eval.school_id !=this.value)
                   {
                    return eval;
                   }
            });
        });
        // console.log(pri_schools);return false;
        // $.each(pri_schools,function(pi,pval){
        //                 form_array +='<option value='+pval.school_id+'>( '+pval.udise_code+') '+pval.school_name+'</option>'
        //             });
        // // console.log(form_array);
        // if(bi !=i)
        // {
        //     // console.log(bi);
        //     $('#school_list'+bi).empty();
        //     $('#school_list'+bi).append(form_array);
        // }
    
        // });

      return !$('#school_list option:selected')
        .remove().appendTo('#selected_schools');  
       } 
      function removedSchool(i) {  
        var final_list = new Array();
        var brte_final_list = new Array();
            var select_sch_id = $("#selected_schools option:selected").val();
            // console.log(select_sch_id,pri_selected_schools);
            if(pri_selected_schools !==undefined)
            {
            var selected_sch_details = pri_selected_schools.filter(pri=>pri.school_id == select_sch_id)[0];
                // console.log(selected_sch_details);return false;
                 final_list.push({'isactive':0,'id':selected_sch_details.id,'school_id':selected_sch_details.school_id});
              brte_final_list.push({'school_id':selected_sch_details.school_id,'brte':0});

         

           
           // console.log(brte_final_list);
           // return false;
            
            swal({
                title: "Are you sure?",
                text: 'Assigned School List Updated',
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#ff0000",
                confirmButtonText: "Confirm",
                cancelButtonText:'Cancel',
                closeOnConfirm: false,
                showLoaderOnConfirm: true
            }, function(isConfirm)
            {
              if(isConfirm){
                var data = {'records':final_list,'school_list':brte_final_list};
             $.ajax(
             {
                method:'POST',
                data:data,
                dataType:'JSON',
                url:'<?=base_url()."Ceo_District/emis_brte_save"?>',
                success:function(res)
                {
                    // console.log(res);

                        swal(
                            {
                              title:"successfully Saved Brte Staff",
                              type:'success',
                              confirmButtonText: "Ok",
                            },function(isConfirm)
                            {

                               return !$('#selected_schools option:selected')
                                .remove().appendTo('#school_list');
                            });
                }
             })
            }
           })
            }else
            {

                // console.log(pri_schools);
                    // $.each(block_array,function(bi,bval){
                    $('#selected_schools option:selected').each(function(si,val){
                        // console.log(this.value);

                   pri_mid_schools.filter((eval,ei)=>
                    {
                           if(eval.school_id ==this.value)
                           {
                            pri_schools.push(eval);
                           }
                    });
                return false;

                });
                // console.log(pri_schools);return false;
               
                // });

                return !$('#selected_schools option:selected')
                                .remove().appendTo('#school_list');
            }
          
       }

     
    
    function selectall()  {  
    $('#selected_features').find('option').each(function() {  
       $(this).attr('selected', 'selected');  
      });
      }   
  

      function search_schools(){
            // console.log(pri_schools);
            var pri_length = $("#selected_schools > option").length;
            
            var pri_school = pri_schools;

            var sch_name = $("#search_school").val();
            // console.log(sch_name);
            var pri_school = pri_schools.filter(function(pri,i)
            {
                    if(sch_name!='')
                    {

                        if(pri.school_name.toLowerCase().indexOf(sch_name.toLowerCase())> -1 || pri.udise_code.toLowerCase().indexOf(sch_name.toLowerCase())> -1)
                        {

                            
                            return true;
                        }
                        return false;
                    }else
                    {
                        return true;
                    }

            });
          
            
            $("#school_list").empty();
            var school_drop ='';

                  $.each(pri_school,function(i,val)
                  {
                    
                            school_drop += '<option value='+val.school_id+'>'+'( '+val.udise_code+' ) '+val.school_name+'</option>';

                    
                  });
            $('#school_list').append(school_drop);

      }


      function save()
      {
        //      pri_school = pri_schools.filter(pri=>pri.school_id==this.value)[0];

          var pri_school = '';
          var final_list  = new Array();
          $("#err_msg").html('');
          var i = 0;
          // var brte_details = $("#brte_teacher").val();
          // console.log(brte_id);
          var pri_length = $("#selected_schools > option").length;
          var hss_id =  $("#hss_id").val();
          var brte_final_list = new Array();
          
          // var brte_detail = '';
           // brte_id =  brte_details.map(function(bval,bi){ //brte value
           //          return teacher_details.filter(brte=>brte.u_id==bval)[0];
           //  });
          
          // console.log(pri_length);return false;
         
          

        if(hss_id==0)
        {
            $("#err_msg").html('<p>Please Select Nodal School');
        }else if(pri_length==0)
        {
            $("#err_msg").html('<p>Please Select Schools under Nodal school');
        }else
        {
            if(map_list_detail !='')
          {
                if(hss_id==map_list_detail.hss_school_id)
                {

                }else
                {
                    brte_final_list.push({'school_id':map_list_detail.hss_school_id,'brte':0});
                }
          }
            var hss_detail = hss_list.filter(hss=>hss.school_id==hss_id)[0];

           $("#selected_schools > option").each(function()
           {
          
              final_list.push({'school_id':this.value,'hss_school_id':hss_detail.school_id,'hss_block_id':hss_detail.block_id,'hss_edu_dist_id':hss_detail.edu_dist_id,'hss_block_name':hss_detail.block_name,'hss_edu_dist_name':hss_detail.edu_dist_name,'hss_udise_code':hss_detail.udise_code,'hss_school_name':hss_detail.school_name,'isactive':1,'id':'','hss_cate_type':hss_detail.cate_type});
              brte_final_list.push({'school_id':this.value,'brte':1});

          });

           brte_final_list.push({'school_id':hss_id,'brte':1});
           // console.log(brte_final_list,final_list);
           // return false;
            var data = {'records':final_list,'school_list':brte_final_list};
            swal({
                title: "Are you sure?",
                text: 'Create Nodal School Group',
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#ff0000",
                confirmButtonText: "Confirm",
                cancelButtonText:'Cancel',
                closeOnConfirm: false,
                showLoaderOnConfirm: true
            }, function(isConfirm)
            {
              if(isConfirm){
             $.ajax(
             {
                method:'POST',
                data:data,
                dataType:'JSON',
                url:'<?=base_url()."Ceo_District/emis_brte_save"?>',
                success:function(res)
                {
                    // console.log(res);

                        swal(
                            {
                              title:"Nodal School Group Created successfully",
                              type:'success',
                              confirmButtonText: "Ok",
                            },function(isConfirm)
                            {

                                window.location.reload();
                            });
                }
             })
            }
           })
        }

          

      }
</script>
<script type="text/javascript">
    // BRTE Staff School Group 
    var teacher_details = <?php echo json_encode($brte_list);?>;
    var school_groups = ''; 
    var brc_list = <?php echo json_encode($brte_brc_map_list);?>;
    var brc_brte_list = '';
    var selected_schools = '';
    var final_array = '';
    var brte_array = new Array();
      function get_school_group(brte_school_id,flag)
      {
        
        if(flag==1){
         $("#"+$("#brte_selection").val()).show();
        
        
        $.ajax(
             {
                method:'POST',
                data:{'school_id':brte_school_id},
                dataType:'JSON',
                url:'<?=base_url()."Ceo_District/get_brte_school_group"?>',
                success:function(res)
                {
                        console.log(res);
                        school_groups = res['result'];
                        if(res['result'].length >0)
                        {
                            
                                school_drop ='';
                                $("#brte_school").empty();
                                $.each(school_groups,function(i,val)
                                {       
                                    school_drop +='<option value='+val.hss_school_id+'>'+'( '+val.hss_udise_code+' ) '+val.hss_school_name+'</option>';
                                });

                                $("#brte_school").html(school_drop);
                                if(res['selected_school'] !=null)
                                {
                                    selected_schools = res['selected_school'];
                                    $("#brte_teacher").val(selected_schools.brte_id.split(",")).trigger('change');
                                    $("#brte_school").val([brte_school_id]).trigger('change');
                                }
                            
                        }
                        $("#brteModal").modal('show');
                }

            });
        }else
        {
            selected_schools = brc_list.filter(brc=>brc.brc_block_id==brte_school_id)[0];
            // console.log(brc_brte_list); 
            $("#brte_teacher").val(selected_schools.brte_id.split(",")).trigger('change');
            $("#brc_block_id").val(selected_schools.brc_block_id);
            $("#brte_selection").val(2);
            $("#"+$("#brte_selection").val()).show();
                        $("#brteModal").modal('show');

        }
        
      }

       $('#brte_teacher').on('select2:select', function(e) {
             // brte_array = new Array();
           
                
            //      var brte_id = $("#brte_teacher").val();
            //                   block_array=   brte_id.map(function(val){
            //                     // console.log(val);
            //     return teacher_details.filter(brte=>brte.u_id==val)[0];
            //                         });

            //     generate_brte_assign_school();
            //    // get_pri_schools(block_name,'',0);
                
                

            

            // console.log(block_array);
      });

      $('#brte_teacher').on('select2:unselect', function(e) {
        // brte_array = new Array();
            brte_array.push(e.params.data.id);

        });

     $('#brte_school').on("select2:unselecting", function(e){
        if(selected_schools !=''){
         var unselected_value = $('#brte_school').val();
         swal({
                title: "Are you sure?",
                text: 'Remove Nodal School Group Assignement',
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#ff0000",
                confirmButtonText: "Confirm",
                cancelButtonText:'Cancel',
                closeOnConfirm: false,
                showLoaderOnConfirm: true
            }, function(isConfirm)
            {
              if(isConfirm)
              {
                 $.ajax(
                    {
                    method:'POST',
                    data:{'school_id':unselected_value},
                    dataType:'JSON',
                    url:'<?=base_url()."Ceo_District/brte_nodal_school_remove"?>',
                    success:function(res)
                    {
                        swal(
                            {
                              title:"School Group Removed successfully",
                              type:'success',
                              confirmButtonText: "Ok",
                            },function(isConfirm)
                            {

                                window.location.reload();
                            });
                    }
                });
              }else
              {

                $("#brte_school").val([unselected_value]).trigger('change');
              }
          });
        }
    });


      function save_brte()
      {
        $("#err_msg_brte").html('');
        final_array = new Array();
          var brte_teacher_id = $("#brte_teacher").val();
          var brte_school = $("#brte_school").val();
          var brc_block = $("#brc_block_id").val();
          var brte_selection = $("#brte_selection").val();
          if(brte_teacher_id ==null)
          {
            $("#err_msg_brte").html('<p>Please Select Brte Staff');
          }else if(brte_school==null && brc_block =='')
          {

              $("#err_msg_brte").html('<p>Please Select '+(brte_selection==1?'Nodal school':'BRC Block'));
          }else
          {
            // alert();
            //    return false;
                if(selected_schools !='' )
                {
                     var brte_id = selected_schools.brte_id.split(",");
                         brte_array = [...new Set(brte_array)];

                    brte_id.map(function(val,i)
                    {
                        if(brte_array.length !=0)
                        {
                           brte_array.filter(function(bval)
                            {
                                if(bval==val)
                                {   
                                    if(selected_schools.school_id!==undefined){
                                    final_array.push({'brte_id':bval,'is_active':0,'school_id':selected_schools.school_id});
                                    }else
                                    {
                                        final_array.push({'brte_id':bval,'is_active':0,'brc_block_id':selected_schools.brc_block_id});
                                    }
                                }
                            });
                           
                        }
                    })
                }
                
                $.each(brte_teacher_id,function(bi,bval)
                {
                    var teacher_detail = teacher_details.filter(teach=>teach.u_id==bval)[0];
                    if(brte_selection==1)
                    {
                        $.each(brte_school,function(si,sval)
                        {
                            var school_group  = school_groups.filter(sch=>sch.hss_school_id==sval)[0];
                            final_array.push({'id':'','school_id':school_group.hss_school_id,'group_id':school_group.hss_udise_code,'brte_id':teacher_detail.u_id,'brte_name':teacher_detail.teacher_name,'brte_sub':teacher_detail.appointed_subject,'is_active':1,'brc_block_id':0});
                        })
                    }else
                    {
                        final_array.push({'id':'','school_id':0,'group_id':0,'brte_id':teacher_detail.u_id,'brte_name':teacher_detail.teacher_name,'brte_sub':teacher_detail.appointed_subject,'is_active':1,'brc_block_id':brc_block});
                    }
                });

               var data = {'records':final_array};
               console.log(data);
            swal({
                title: "Are you sure?",
                text: 'Create Brte School Group',
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#ff0000",
                confirmButtonText: "Confirm",
                cancelButtonText:'Cancel',
                closeOnConfirm: false,
                showLoaderOnConfirm: true
            }, function(isConfirm)
            {
              if(isConfirm){
                // console.log(final_array);return false;
             $.ajax(
             {
                method:'POST',
                data:data,
                dataType:'JSON',
                url:'<?=base_url()."Ceo_District/save_brte_school_group"?>',
                success:function(res)
                {
                    // console.log(res);

                        swal(
                            {
                              title:"Brte School Group Created successfully",
                              type:'success',
                              confirmButtonText: "Ok",
                            },function(isConfirm)
                            {

                                window.location.reload();
                            });
                }
             })
            }
           })
        }
          }


        $("#brte_selection").change(function()
        {
            $(".sgroup").hide();
            $("#"+$(this).val()).show();
        })
      
</script>


    </body>

</html>